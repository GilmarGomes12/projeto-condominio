<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Ocorrências</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="/templates/assets/img/favicon.png" rel="icon" />
    <link href="/templates/assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Jost:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet" />

    <!-- Vendor CSS Files -->
    <link href="/templates/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/templates/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="/templates/assets/vendor/aos/aos.css" rel="stylesheet" />
    <link href="/templates/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
    <link href="/templates/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <!-- Main CSS File -->
    <link href="/templates/assets/css/main.css" rel="stylesheet"/>
    <link href="/templates/assets/css/custom.css" rel="stylesheet"/>

</head>

<body class="visitante-page">
    <header id="header" class="header d-flex align-items-center sticky-top">
        <div class="container-fluid container-xl position-relative d-flex align-items-center">

            <a href="/index.html" class="logo d-flex align-items-center me-auto">
                <img src="/templates/assets/img/logo.jpg" alt="">
                <h1 class="sitename">Condomínio Varandas do Praia</h1>
            </a>

            <nav id="navmenu" class="navmenu">
                <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
            </nav>

            <a class="btn-getstarted" href="/menu">Menu</a>
        </div>
    </header>

    <main class="main">
        <!-- Título da página -->
        <div class="page-title" data-aos="fade">
            <div class="container">
                <nav class="breadcrumbs">  
                </nav>
                <h1>Formulário de Ocorrências</h1>
            </div>
        </div>

    <!-- Script para gerar número de ocorrência -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function gerarNumeroOcorrencia() {
                const timestamp = Date.now().toString(); 
                const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0'); 
                return `OCOR-${timestamp}-${randomNum}`;
            }

            const inputOcorrencia = document.getElementById('numero-ocorrencia');
            inputOcorrencia.value = gerarNumeroOcorrencia();
        });
    </script>

    <!-- Seção do formulário de ocorrência -->
    <section id="starter-section" class="starter-section section">
        <div class="container" data-aos="fade-up">
            <form id="ocorrencia-form" action="/ocorrencias" method="POST">
                <div class="mb-3">
                    <label for="numero-ocorrencia" class="form-label">Número da Ocorrência</label>
                    <input type="text" class="form-control" id="numero-ocorrencia" name="numero_ocorrencia" required>
                </div>
                <div class="mb-3">
                    <label for="data-ocorrencia" class="form-label">Data da Ocorrência</label>
                    <input type="date" class="form-control" id="data-ocorrencia" name="data_ocorrencia" required>
                </div>
                <div class="mb-3">
                    <label for="nome-funcionario" class="form-label">Nome do Funcionário</label>
                    <input type="text" class="form-control" id="nome-funcionario" name="nome_funcionario" required>
                </div>
                <div class="mb-3">
                    <label for="funcao-funcionario" class="form-label">Função do Funcionário</label>
                    <input type="text" class="form-control" id="funcao-funcionario" name="funcao_funcionario" required>
                </div>
                <div class="mb-3">
                    <label for="hora-registro" class="form-label">Hora do Registro</label>
                    <input type="time" class="form-control" id="hora-registro" name="hora_registro" required>
                </div>
                <div class="mb-3">
                    <label for="data-registro" class="form-label">Data do Registro</label>
                    <input type="date" class="form-control" id="data-registro" name="data_registro" required>
                </div>
                <div class="mb-3">
                    <label for="unidade-envolvida" class="form-label">Unidade Envolvida</label>
                    <input type="text" class="form-control" id="unidade-envolvida" name="unidade_envolvida">
                </div>
                <div class="mb-3">
                    <label for="bloco" class="form-label">Bloco</label>
                    <input type="text" class="form-control" id="bloco" name="bloco" required>
                </div>
                <div class="mb-3">
                    <label for="autor-ocorrencia" class="form-label">Autor da Ocorrência</label>
                    <input type="text" class="form-control" id="autor-ocorrencia" name="autor_ocorrencia" required>
                </div>
                <div class="mb-3">
                    <label for="descricao-ocorrencia" class="form-label">Descrição da Ocorrência</label>
                    <textarea class="form-control" id="descricao-ocorrencia" name="descricao_ocorrencia" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Registrar Ocorrência</button>
            </form>
        </div>
    </section>

    <script>
        document.getElementById('ocorrencia-form').addEventListener('submit', async function(event) {
            event.preventDefault();
    
            const form = event.target;
            const formData = new FormData(form);
            const data = {};
    
            formData.forEach((value, key) => {
                if (key === 'data_ocorrencia' || key === 'data_registro') {
                    // Converte a data para o formato ISO 8601
                    data[key] = new Date(value).toISOString();
                } else {
                    data[key] = value;
                }
            });
    
            try {
                const response = await fetch('/ocorrencias', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
    
                if (!response.ok) {
                    throw new Error('Erro ao registrar ocorrência');
                }
    
                const result = await response.json();
                console.log('Ocorrência registrada com sucesso:', result);
    
                // Limpa o formulário após o envio bem-sucedido
                form.reset();
            } catch (error) {
                console.error('Erro:', error);
            }
        });
    </script>

    <!-- Main JS File -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.9/jquery.inputmask.min.js"></script>
    <script src="/templates/assets/js/main.js"></script>
    <script src="/templates/assets/js/script.js"></script>

    <footer id="footer" class="footer">

    </footer>

    <!-- Scroll Top -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <!-- Preloader -->
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="/templates/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/templates/assets/vendor/php-email-form/validate.js"></script>
    <script src="/templates/assets/vendor/aos/aos.js"></script>
    <script src="/templates/assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="/templates/assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="/templates/assets/vendor/waypoints/noframework.waypoints.js"></script>
    <script src="/templates/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="/templates/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

    <!-- Main JS File -->
    <script src="/templates/assets/js/main.js"></script>
</body>

</html>